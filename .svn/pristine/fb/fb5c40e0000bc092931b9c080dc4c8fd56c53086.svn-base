<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E pro Map</title>

  <!-- vWorld -->
  <script
    type="text/javascript"
    src="https://map.vworld.kr/js/webglMapInit.js.do?version=3.0&apiKey=3907B382-CD3D-304B-A82F-C7BFA4286232">
  </script>

  <!-- ë„ˆ ì›ë˜ CSS -->
  <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />

  <style>
    .placeholder {
      position: relative;
    }

    /* 1) íŒ¨ë„: transformìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ */
    #mapSidebar {
      position: absolute;
      top: 0;
      left: 0;
      width: 380px;
      height: 100%;
      z-index: 2147483647;
      pointer-events: auto;
      transform: translateX(-100%);
      transition: transform .35s ease;
    }
    /* placeholderì— í´ë˜ìŠ¤ê°€ ë¶™ìœ¼ë©´ íŒ¨ë„ì´ ì—´ë¦¼ */
    .placeholder.map-panel-open #mapSidebar {
      transform: translateX(0);
    }

    /* 2) ë²„íŠ¼ë„ transformìœ¼ë¡œë§Œ ì´ë™ (íŒ¨ë„ ì—´ë¦´ ë•Œ ê°™ì´) */
    #mapSidebarToggleBtn {
      position: absolute;
      top: 50%;
      left: 0;
      /* ê¸°ë³¸ì€ íŒ¨ë„ì´ ì•ˆ ë³´ì´ë‹ˆê¹Œ íŒ¨ë„ ë°”ë¡œ ìœ„ì—ì„œ ëŒ€ê¸° */
      transform: translate(0, -50%);
      width: 40px;
      height: 80px;
      border: none;
      border-radius: 0 10px 10px 0;
      background: linear-gradient(135deg, #4d7c4d 0%, #3b5f3b 100%);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 3px 0 10px rgba(0,0,0,0.3);
      z-index: 2147483647;
      pointer-events: auto;
      transition: transform .35s ease;
    }
    /* íŒ¨ë„ì´ ì—´ë¦´ ë•Œ ë²„íŠ¼ë„ ê°™ì€ ì‹œê°„ì— ê°™ì€ ê±°ë¦¬ë¡œ ì´ë™ */
    .placeholder.map-panel-open #mapSidebarToggleBtn {
      /* íŒ¨ë„ í­(380px)ë§Œí¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ, ìœ„ìª½ì€ ê·¸ëŒ€ë¡œ -50% */
      transform: translate(380px, -50%);
    }

    #mapSidebarToggleBtn .arrow {
      transition: transform .35s ease;
      display: inline-block;
    }
    .placeholder.map-panel-open #mapSidebarToggleBtn .arrow {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <!-- ê³µí†µ ì‚¬ì´ë“œë°” -->
  <div th:replace="fragments/sidebar :: sidebar"></div>

  <!-- ë©”ì¸ -->
  <main class="main">
    <div class="main-layout">
      <!-- ğŸ”¥ ì—¬ê¸° í´ë˜ìŠ¤ í† ê¸€ë§Œìœ¼ë¡œ íŒ¨ë„/ë²„íŠ¼ ë‘˜ ë‹¤ ì›€ì§ì´ê²Œ í•  ê±°ë‹¤ -->
      <div class="placeholder map-panel-open" id="mapContainer">
        <!-- ì§€ë„ -->
        <div id="vmap" style="width:100%; height:100%; min-height:500px;"></div>

        <!-- ì§€ë„ ì•ˆìª½ ì‚¬ì´ë“œë°” -->
        <div id="mapSidebar" class="map-sidebar">
          <div class="map-sidebar-header">
            <h3>ğŸ¢ ê±´ë¬¼ ì •ë³´</h3>
          </div>

          <div class="map-sidebar-content">
            <div class="map-search">
              <h4>ğŸ” ì£¼ì†Œ ê²€ìƒ‰</h4>
              <div class="map-search-controls">
                <input type="text" id="mapSearchInput" placeholder="ë„ë¡œëª… ë˜ëŠ” ì§€ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" />
                <button id="mapSearchBtn" class="map-search-btn">ê²€ìƒ‰</button>
              </div>
              <p class="map-search-helper">ê²€ìƒ‰ í›„ ì§€ë„ë¥¼ ì´ë™í•˜ë©´ ìƒë‹¨ ì¹´ë©”ë¼ê°€ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="info-section">
              <label>ğŸ“ ë„ë¡œëª…ì£¼ì†Œ</label>
              <div class="info-value" id="sidebar_address">ê±´ë¬¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”</div>
            </div>

            <div class="info-section">
              <label>â° ë…¸í›„ë„</label>
              <div class="info-value highlight" id="sidebar_age">-</div>
            </div>

            <div class="info-section detail-section">
              <label>ğŸ“‹ ìƒì„¸ì •ë³´</label>
              <div class="info-value" id="sidebar_road">-</div>
            </div>

            <div class="divider"></div>

            <div class="info-section">
              <label>ğŸ—ï¸ ê±´ë¬¼ìš©ë„</label>
              <div class="info-value" id="sidebar_purpose">-</div>
            </div>

            <div class="divider"></div>

            <div class="graph-section">
              <h4>ğŸ“Š ë¶„ì„ ê·¸ë˜í”„</h4>
              <div class="graph-container" id="sidebar_graphs">
                <div class="graph-placeholder">ê·¸ë˜í”„ 1 ì˜ì—­</div>
                <div class="graph-placeholder">ê·¸ë˜í”„ 2 ì˜ì—­</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì§€ë„ ìœ„ í† ê¸€ ë²„íŠ¼ -->
        <button id="mapSidebarToggleBtn" type="button">
          <span class="arrow">â–¶</span>
        </button>

      </div>
    </div>
  </main>

  <!-- vWorld ì´ˆê¸°í™” js -->
  <script th:src="@{/js/script.js}" src="/js/script.js"></script>

  <!-- ì‚¬ì´ë“œë°” ì—¬ë‹«ê¸°: placeholderì—ë§Œ í´ë˜ìŠ¤ í† ê¸€ -->
  <script>
    (function () {
      const container = document.getElementById('mapContainer');
      const btn = document.getElementById('mapSidebarToggleBtn');
      if (!container || !btn) return;

      btn.addEventListener('click', function (e) {
        e.stopPropagation();
        container.classList.toggle('map-panel-open');
      });
    })();
  </script>
</body>
</html>
