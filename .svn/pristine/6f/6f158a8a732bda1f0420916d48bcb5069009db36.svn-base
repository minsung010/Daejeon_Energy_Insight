<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>E pro · Dashboard</title>

  <!-- vWorld (작은 지도용) -->
  <script
    type="text/javascript"
    src="https://map.vworld.kr/js/webglMapInit.js.do?version=3.0&apiKey=3907B382-CD3D-304B-A82F-C7BFA4286232">
  </script>

  <!-- 공통 CSS -->
  <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />

  <style>
    :root { --gap: 16px; }

    html, body { height: 100%;  }
    body {
      margin: 0;
      background: #dfe7db;
      display: flex;
      overflow: hidden;
      font-family: 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
    }
#naviTopPannel3d { display: none !important; }
    .main {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      padding: var(--gap);
      padding-right: 28px;
      box-sizing: border-box;
      overflow: auto;
    }

    .topbar {
      position: sticky; top: 0;
      background:#fff;
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 10px;
      padding: 10px 14px;
      z-index: 5;
    }

    .kpi-grid {
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap);
    }
    .kpi {
      background:#fff;
      border:1px solid rgba(0,0,0,.06);
      border-radius:12px;
      padding:14px;
      min-height: 88px;
    }
    .kpi .title { font-size:12px; color:#6b7280 }
    .kpi .value { font-size:22px; font-weight:800; margin-top:6px }

    .cards {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
    }
    .card {
      background:#fff;
      border:1px solid rgba(0,0,0,.06);
      border-radius:12px;
      padding:14px;
      min-height:280px;
      box-sizing: border-box;
    }

    /* 작은 지도 카드 */
    .mini-map-card {
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 360px;
    }
    .mini-map-header {
      padding: 12px 14px 6px;
      font-weight: 600;
      font-size: 14px;
    }
    /* 여기 id를 vmap으로 해서 네 기존 script.js가 써도 되게 */
    #vmap {
      width: 100%;
      height: 425px;
      border-radius: 0 0 12px 12px;
      overflow: hidden;
      cursor: pointer;
      background: #eef2ec;
    }

    /* 공지 미리보기 카드 */
    .notice-card {
      display: flex;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
    }
    .notice-card-header {
      display:flex;
      justify-content: space-between;
      align-items: center;
    }
    .notice-card-title {
      font-weight: 600;
      font-size: 14px;
    }
    .notice-more {
      font-size: 12px;
      color: #4b6b4b;
    }
    .notice-mini-table {
      width: 100%;
      border-collapse: collapse;
    }
    .notice-mini-table th,
    .notice-mini-table td {
      padding: 6px 4px;
      border-bottom: 1px solid #f1f1f1;
      font-size: 13px;
    }
    .notice-mini-table tr:last-child td {
      border-bottom: none;
    }
    .notice-mini-table td.title {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 220px;
    }

    @media (max-width: 1200px) {
      .kpi-grid { grid-template-columns: repeat(2, 1fr); }
      .cards { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- 사이드바 -->
  <div th:replace="~{fragments/sidebar :: sidebar}"></div>

  <main class="main">
    <div class="topbar"><strong>에너지 대시보드</strong></div>

    <section class="kpi-grid">
      <div class="kpi"><div class="title">건물 수</div><div class="value">-</div></div>
      <div class="kpi"><div class="title">전력 사용 합계</div><div class="value">-</div></div>
      <div class="kpi"><div class="title">가스 사용 합계</div><div class="value">-</div></div>
      <div class="kpi"><div class="title">데이터 상태</div><div class="value">-</div></div>
    </section>

    <section class="cards">
      <div class="card">노후도별 에너지 (차트 자리)</div>
      <div class="card">향후 12개월 예측 (차트 자리)</div>

      <!-- 작은 지도 -->
      <div class="card mini-map-card">
        <div class="mini-map-header">지도 미리보기 (클릭하면 /map)</div>
        <div id="vmap" title="클릭하면 /map으로 이동합니다."></div>
      </div>

      <!-- 공지 미리보기 -->
      <div class="card notice-card" id="noticePreview">
        <div class="notice-card-header">
          <div class="notice-card-title">공지사항</div>
          <div class="notice-more">전체보기 →</div>
        </div>
        <table class="notice-mini-table">
          <tbody>
          <!-- 네가 notice 페이지에서 쓰던 데이터 축약 -->
          <tr>
            <td style="width:48px; color:#6b7280;">1</td>
            <td class="title">E% 시스템 업데이트 예정 안내</td>
            <td style="width:90px; text-align:right; color:#6b7280;">2025-11-12</td>
          </tr>
          <tr>
            <td style="width:48px; color:#6b7280;">2</td>
            <td class="title">데이터 점검 공지</td>
            <td style="width:90px; text-align:right; color:#6b7280;">2025-11-08</td>
          </tr>
          <tr>
            <td style="width:48px; color:#6b7280;">3</td>
            <td class="title">초기 가이드 문서 공개</td>
            <td style="width:90px; text-align:right; color:#6b7280;">2025-11-01</td>
          </tr>
          <tr>
            <td style="width:48px; color:#6b7280;">3</td>
            <td class="title">시스템 점검 예정 안내</td>
            <td style="width:90px; text-align:right; color:#6b7280;">2025-10-29</td>
          </tr>
          <tr>
            <td style="width:48px; color:#6b7280;">3</td>
            <td class="title">시스템 업데이트 정보 안내</td>
            <td style="width:90px; text-align:right; color:#6b7280;">2025-10-24</td>
          </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 네가 원래 쓰던 지도 초기화 js (vmap용) -->
  <script th:src="@{/js/script.js}" src="/js/script.js"></script>

  <!-- 클릭 이벤트들 -->
  <script>
  
    document.addEventListener('DOMContentLoaded', function () {
      // 1) 대시보드 작은 지도 클릭 -> /map
      var smallMap = document.getElementById('vmap');
      if (smallMap) {
        smallMap.addEventListener('click', function () {
          // context-path 있으면 '/epro/map' 으로 바꾸기
          window.location.href = '/map';
        });
      }

      // 2) 공지 미리보기 카드 클릭 -> /notice
      var noticeCard = document.getElementById('noticePreview');
      if (noticeCard) {
        noticeCard.addEventListener('click', function () {
          // context-path 있으면 '/epro/notice' 로 바꾸기
          window.location.href = '/notice';
        });
      }
      
//       document.getElementById('naviTopPannel3d').style.display = 'none';
    });
  </script>
</body>
</html>
