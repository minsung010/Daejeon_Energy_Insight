<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E pro Map</title>

  <script
    type="text/javascript"
    src="https://map.vworld.kr/js/webglMapInit.js.do?version=3.0&apiKey=3907B382-CD3D-304B-A82F-C7BFA4286232">
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />

  <style>
    .placeholder {
      position: relative;
    }

    /* 1) íŒ¨ë„: transformìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ */
    #mapSidebar {
      position: absolute;
      top: 0;
      left: 0;
      width: 380px;
      height: 100%;
      z-index: 2147483647;
      pointer-events: auto;
      transform: translateX(-100%);
      transition: transform .35s ease;
    }
    /* placeholderì— í´ë˜ìŠ¤ê°€ ë¶™ìœ¼ë©´ íŒ¨ë„ì´ ì—´ë¦¼ */
    .placeholder.map-panel-open #mapSidebar {
      transform: translateX(0);
    }

    /* 2) ë²„íŠ¼ë„ transformìœ¼ë¡œë§Œ ì´ë™ (íŒ¨ë„ ì—´ë¦´ ë•Œ ê°™ì´) */
    #mapSidebarToggleBtn {
      position: absolute;
      top: 50%;
      left: 0;
      /* ê¸°ë³¸ì€ íŒ¨ë„ì´ ì•ˆ ë³´ì´ë‹ˆê¹Œ íŒ¨ë„ ë°”ë¡œ ìœ„ì—ì„œ ëŒ€ê¸° */
      transform: translate(0, -50%);
      width: 40px;
      height: 80px;
      border: none;
      border-radius: 0 10px 10px 0;
      background: linear-gradient(135deg, #4d7c4d 0%, #3b5f3b 100%);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 3px 0 10px rgba(0,0,0,0.3);
      z-index: 2147483647;
      pointer-events: auto;
      transition: transform .35s ease;
    }
    /* íŒ¨ë„ì´ ì—´ë¦´ ë•Œ ë²„íŠ¼ë„ ê°™ì€ ì‹œê°„ì— ê°™ì€ ê±°ë¦¬ë¡œ ì´ë™ */
    .placeholder.map-panel-open #mapSidebarToggleBtn {
      /* íŒ¨ë„ í­(380px)ë§Œí¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ, ìœ„ìª½ì€ ê·¸ëŒ€ë¡œ -50% */
      transform: translate(380px, -50%);
    }

    #mapSidebarToggleBtn .arrow {
      transition: transform .35s ease;
      display: inline-block;
    }
    .placeholder.map-panel-open #mapSidebarToggleBtn .arrow {
      transform: rotate(180deg);
    }
  </style>
</head>
<body>
  <div th:replace="fragments/sidebar :: sidebar"></div>

  <main class="main">
    <div class="main-layout">
      <div class="placeholder map-panel-open" id="mapContainer">
        <div id="vmap" style="width:100%; height:100%; min-height:500px;"></div>

        <div id="mapSidebar" class="map-sidebar">
          <div class="map-sidebar-header">
            <h3>ğŸ¢ ê±´ë¬¼ ì •ë³´ & ë¶„ì„</h3>
          </div>

          <div class="map-sidebar-content">
            <div class="map-search">
              <h4>ğŸ” ì£¼ì†Œ ê²€ìƒ‰</h4>
              <div class="map-search-controls">
                <input type="text" id="mapSearchInput" placeholder="ë„ë¡œëª… ë˜ëŠ” ì§€ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" />
                <button id="mapSearchBtn" class="map-search-btn">ê²€ìƒ‰</button>
              </div>
            </div>

            <div class="info-section">
              <label>ğŸ“ ë„ë¡œëª…ì£¼ì†Œ</label>
              <div class="info-value" id="sidebar_address">ê±´ë¬¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”</div>
            </div>

            <div class="info-section detail-section">
              <label>ğŸ“‹ ìƒì„¸ì •ë³´</label>
              <div class="info-value" id="sidebar_road">-</div>
            </div>

            <div class="info-section">
              <div class="info-label-with-legend" >
                <label>ğŸ•‘ ë…¸í›„ë„</label>
              </div>
              <ul class="age-legend" style="margin-bottom: 7px; margin-left: 2px;">
                <li><span class="age-chip age-0-9"></span>0~9ë…„</li>
                <li><span class="age-chip age-10-20"></span>10~20ë…„</li>
                <li><span class="age-chip age-20-30"></span>20~30ë…„</li>
                <li><span class="age-chip age-30-plus"></span>30ë…„ ì´ìƒ</li>
                <li><span class="age-chip age-unknown"></span>ì •ë³´ ì—†ìŒ</li>
              </ul>
              <div class="info-value highlight" id="sidebar_age">-</div>
            </div>

            <div class="divider"></div>

            <div class="info-section">
              <label>ğŸ—ï¸ ê±´ë¬¼ìš©ë„</label>
              <div class="info-value" id="sidebar_purpose">-</div>
            </div>

            <div class="divider"></div>

            <div class="graph-section">
              <div class="graph-header">
                <h4>ğŸ“Š ë¶„ì„ ê·¸ë˜í”„</h4>
                <div class="usage-toggle" id="usageMetricToggle">
                  <button type="button" data-usage-metric="total" class="is-active">ì´ ì—ë„ˆì§€</button>
                  <button type="button" data-usage-metric="electric">ì „ê¸°</button>
                  <button type="button" data-usage-metric="gas">ê°€ìŠ¤</button>
                </div>
              </div>
              
              <div class="graph-container" id="sidebar_graphs"> 
                <div id="myHouseChart">
                  <canvas id="myHouseChartCanvas"></canvas>
                  <div class="graph-placeholder">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
                </div>
                <div id="compareChart">
                  <canvas id="compareChartCanvas"></canvas>
                  <div class="graph-placeholder"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button id="mapSidebarToggleBtn" type="button">
          <span class="arrow">â–¶</span>
        </button>

      </div>
    </div>
  </main>

  <script th:src="@{/js/script.js}" src="/js/script.js"></script>

  <script>
    (function () {
      const container = document.getElementById('mapContainer');
      const btn = document.getElementById('mapSidebarToggleBtn');
      if (!container || !btn) return;

      btn.addEventListener('click', function (e) {
        e.stopPropagation();
        container.classList.toggle('map-panel-open');
      });
    })();
  </script>
</body>
</html>